<div class="container my-4">
  <div class="d-flex align-items-center mb-3">
    <h2 class="text-primary fw-bold me-2">📡 Monitoreo IoT</h2>
   <span class="badge badge-realtime">En tiempo real</span>
  </div>

    <p class="text-muted">
    En esta sección podrás visualizar en tiempo real los signos vitales y la actividad de las mascotas internadas con dispositivos IoT. 
    Esta información ayuda a los veterinarios a detectar anomalías y tomar decisiones rápidas para el cuidado de cada paciente.
  </p>

  <div class="alert alert-warning shadow-sm">
    ⚠ Recuerda: El monitoreo solo está disponible durante internamientos veterinarios con dispositivos IoT activos.
  </div>

  <!-- Filtros -->
  <div class="d-flex gap-2 mb-3">
    <input type="text" class="form-control w-25" placeholder="🔎 Buscar mascota..." [(ngModel)]="filtroNombre">
    <select class="form-select w-auto" [(ngModel)]="filtroEstadoLED">
      <option value="">Todos</option>
      <option value="Verde">Verde</option>
      <option value="Amarillo">Amarillo</option>
      <option value="Rojo">Rojo</option>
    </select>
  </div>

  <h5 class="fw-bold mt-4">🐾 Mascotas internadas con IoT activo</h5>
  <table class="table table-hover shadow-sm" *ngIf="mascotasFiltradas.length > 0; else sinDatos">
    <thead class="table-light">
      <tr>
        <th class="text-center">ID</th>
        <th class="text-center">Mascota</th>
        <th class="text-center">Ritmo Cardíaco (bpm)</th>
        <th class="text-center">Actividad</th>
        <th class="text-center">Ubicación</th>
        <th>Estado LED</th>
        <th>Última Actualización</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let m of mascotasFiltradas">
        <td>{{ m.id }}</td>
        <td>{{ m.nombreMascota }}</td>
        <td [ngClass]="{'text-danger fw-bold': m.ritmoCardiaco > 160 || m.ritmoCardiaco < 60}">
          {{ m.ritmoCardiaco }}
        </td>
        <td>{{ m.actividad }}%</td>
        <td>{{ m.ubicacion }}</td>
        <td>
          <span [ngClass]="{
            'badge bg-success': m.estadoLED==='Verde',
            'badge bg-warning text-dark': m.estadoLED==='Amarillo',
            'badge bg-danger': m.estadoLED==='Rojo'
          }">{{ m.estadoLED }}</span>
        </td>
        <td>{{ m.ultimaActualizacion | date:'short' }}</td>
        <td>
          <button class="btn btn-outline-danger btn-sm me-2" (click)="eliminar(m.id)">🗑 Eliminar</button>
          <button class="btn btn-outline-info btn-sm" (click)="verGraficas(m)">📊 Ver gráficas</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #sinDatos>
    <p class="text-muted">⚠ No hay mascotas en monitoreo actualmente.</p>
  </ng-template>

  <!-- Modal con gráficas -->
  <div class="modal-backdrop" *ngIf="mascotaSeleccionada">
    <div class="modal-content shadow-lg p-4">
      <h4 class="mb-3">📊 Evolución de {{ mascotaSeleccionada?.nombreMascota }}</h4>
      
      <canvas baseChart 
              [datasets]="ritmoCardiacoData"
              [labels]="labels"
              [options]="chartOptions"
              [type]="'line'">
      </canvas>

      <canvas baseChart class="mt-4"
              [datasets]="actividadData"
              [labels]="labels"
              [options]="chartOptions"
              [type]="'line'">
      </canvas>

      <button class="btn btn-secondary mt-3" (click)="cerrarGraficas()">Cerrar</button>
    </div>
  </div>
</div>