<div class="container my-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-primary mb-0">üêæ Lista de Mascotas</h3>
    <a routerLink="/mascotas/registrar" class="btn btn-success">‚ûï Nueva Mascota</a>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2">Cargando mascotas...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Tabla de mascotas -->
  <div class="table-responsive" *ngIf="!loading && mascotas.length > 0">
    <table class="table table-hover shadow-sm">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Especie</th>
          <th>Raza</th>
          <th>Edad</th>
          <th>Estado Salud</th>
          <th>Internado</th>
          <th>Collar</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of mascotas">
          <td>{{ m.id }}</td>
          <td class="fw-bold">{{ m.nombre }}</td>
          <td>{{ m.especie }}</td>
          <td>{{ m.raza || '-' }}</td>
          <td>{{ m.edad }} a√±os</td>
          <td>
            <span class="badge" [ngClass]="getEstadoBadgeClass(m.estadoSalud)">
              {{ formatEstado(m.estadoSalud) }}
            </span>
          </td>
          <td>
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                [checked]="m.internado"
                (change)="toggleInternado(m)"
                style="cursor: pointer;">
            </div>
          </td>
          <td>
            <span *ngIf="m.collarId" class="badge bg-primary">
              Collar #{{ m.collarId }}
            </span>
            <span *ngIf="!m.collarId" class="text-muted">Sin collar</span>
          </td>
          <td>
            <div class="d-flex gap-1 flex-wrap">
              <a [routerLink]="['/monitoreo', m.id]" 
                 class="btn btn-outline-info btn-sm"
                 [class.disabled]="!m.internado">
                üìä Monitor
              </a>
              <button 
                *ngIf="!m.collarId" 
                class="btn btn-outline-primary btn-sm"
                (click)="abrirModalVincular(m)">
                üîó Vincular
              </button>
              <button 
                *ngIf="m.collarId" 
                class="btn btn-outline-warning btn-sm"
                (click)="desvincularCollar(m)">
                ‚úÇÔ∏è Desvincular
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Sin mascotas -->
  <div *ngIf="!loading && mascotas.length === 0 && !error" class="text-center py-5">
    <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Sin mascotas" width="100" class="mb-3">
    <h4 class="text-muted">No hay mascotas registradas</h4>
    <a routerLink="/mascotas/registrar" class="btn btn-success mt-3">Registrar primera mascota</a>
  </div>
</div>

<!-- Modal Vincular Collar -->
<div class="modal-backdrop" *ngIf="mascotaSeleccionada" (click)="cerrarModal()">
  <div class="modal-content p-4" (click)="$event.stopPropagation()">
    <h5 class="mb-3">üîó Vincular Collar a {{ mascotaSeleccionada.nombre }}</h5>
    
    <div class="mb-3">
      <label class="form-label">Seleccionar collar disponible:</label>
      <select class="form-select" [(ngModel)]="collarSeleccionado">
        <option [ngValue]="null">-- Seleccionar --</option>
        <option *ngFor="let c of collaresDisponibles" [ngValue]="c.id">
          {{ c.code }} (ID: {{ c.id }})
        </option>
      </select>
    </div>

    <div *ngIf="collaresDisponibles.length === 0" class="alert alert-warning">
      No hay collares disponibles
    </div>

    <div class="d-flex gap-2">
      <button 
        class="btn btn-success" 
        [disabled]="!collarSeleccionado"
        (click)="vincularCollar()">
        Vincular
      </button>
      <button class="btn btn-secondary" (click)="cerrarModal()">Cancelar</button>
    </div>
  </div>
</div>