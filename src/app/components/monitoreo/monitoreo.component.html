<div class="container my-4">
  <div class="d-flex align-items-center mb-4">
    <a routerLink="/mascotas" class="btn btn-outline-secondary me-3">â† Volver</a>
    <h2 class="text-primary fw-bold mb-0">ğŸ“Š Monitoreo en Tiempo Real</h2>
    <span class="badge bg-info ms-3">ğŸ”„ ActualizaciÃ³n cada 5s</span>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-2">Cargando datos de monitoreo...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Contenido -->
  <div *ngIf="!loading && monitor" class="row">
    
    <!-- InformaciÃ³n de la mascota -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">ğŸ¾ {{ monitor.nombre }}</h5>
        </div>
        <div class="card-body">
          <p><strong>Edad:</strong> {{ monitor.edad }} aÃ±os</p>
          <p><strong>Raza:</strong> {{ monitor.raza || 'No especificada' }}</p>
          <p><strong>Hora de ingreso:</strong> {{ monitor.horaIngresa }}</p>
          <p>
            <strong>Estado de salud:</strong> 
            <span [class]="getEstadoSaludClass()">{{ monitor.estadoSalud }}</span>
          </p>
        </div>
      </div>
    </div>

    <!-- Ritmo cardÃ­aco actual -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100 text-center">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">ğŸ’“ Ritmo CardÃ­aco</h5>
        </div>
        <div class="card-body d-flex flex-column justify-content-center">
          <div *ngIf="monitor.currentHeartRate !== null; else sinDatos">
            <h1 [class]="getBpmClass()" style="font-size: 4rem;">
              {{ monitor.currentHeartRate }}
            </h1>
            <p class="text-muted">BPM</p>
          </div>
          <ng-template #sinDatos>
            <p class="text-muted">Sin datos de sensor</p>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- Ãšltimas lecturas -->
    <div class="col-md-4 mb-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">ğŸ“ˆ Ãšltimas 6 lecturas</h5>
        </div>
        <div class="card-body">
          <ul class="list-group list-group-flush" *ngIf="monitor.lastSixHeartRate.length > 0; else sinLecturas">
            <li class="list-group-item d-flex justify-content-between" 
                *ngFor="let bpm of monitor.lastSixHeartRate; let i = index">
              <span>Lectura #{{ i + 1 }}</span>
              <span class="badge bg-secondary">{{ bpm }} BPM</span>
            </li>
          </ul>
          <ng-template #sinLecturas>
            <p class="text-muted text-center">No hay lecturas registradas</p>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- GrÃ¡fico -->
  <div *ngIf="!loading && monitor && monitor.lastSixHeartRate.length > 0" class="card shadow-sm mb-4">
    <div class="card-header">
      <h5 class="mb-0">ğŸ“‰ EvoluciÃ³n del Ritmo CardÃ­aco</h5>
    </div>
    <div class="card-body" style="height: 300px;">
      <canvas baseChart
              [data]="chartData"
              [options]="chartOptions"
              [type]="'line'">
      </canvas>
    </div>
  </div>

  <!-- Historial completo -->
  <div *ngIf="historial.length > 0" class="card shadow-sm">
    <div class="card-header">
      <h5 class="mb-0">ğŸ“‹ Historial Completo de Latidos</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm table-hover">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Tiempo</th>
              <th>BPM</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let h of historial; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ h.tiempo }}</td>
              <td>
                <span class="badge" 
                      [ngClass]="h.bpm < 60 || h.bpm > 160 ? 'bg-danger' : 'bg-success'">
                  {{ h.bpm }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>